<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Water Monitoring System</title>

  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Bootstrap CSS & JS for responsive layout and components -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Custom Styles -->
  <style>
    :root {
      --bg-color: #f8f9fa;
      --text-color: #212529;
      --primary-color: #007bff;
      --header-bg: #0d6efd;
    }

    /* Dark theme variables */
    [data-theme="dark"] {
      --bg-color: #1c1f2e;
      --text-color: #f8f9fa;
      --primary-color: #0dcaf0;
      --header-bg: #1f2633;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
    }

    .navbar, .card-header {
      background-color: var(--header-bg);
      color: white;
    }

    .card {
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-bottom: 1rem;
    }

    .form-section {
      max-width: 500px;
      margin: 2rem auto;
    }

    .dashboard {
      display: none;
    }

    .chart-container {
      position: relative;
      height: 300px;
    }
  </style>
</head>
<body data-theme="light">

<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid">
    <span class="navbar-brand">Smart Water Monitoring</span>
    <button class="btn btn-outline-light btn-sm" onclick="toggleTheme()">ðŸŒ“ Toggle Theme</button>
  </div>
</nav>

<!-- Main Container -->
<div class="container mt-4">

  <!-- Sign Up Section -->
  <div class="form-section" id="signupSection">
    <h3 class="text-center">Sign Up</h3>
    <div class="mb-3">
      <label for="signupUsername" class="form-label">Username</label>
      <input type="text" class="form-control" id="signupUsername" required>
    </div>
    <div class="mb-3">
      <label for="signupPassword" class="form-label">Password</label>
      <input type="password" class="form-control" id="signupPassword" required>
    </div>
    <button class="btn btn-primary w-100" onclick="signUpUser()">Create Account</button>
    <p class="text-center mt-3">Already have an account? <a href="#" onclick="showLogin()">Log in</a></p>
  </div>

  <!-- Login Section -->
  <div class="form-section" id="loginSection">
    <h3 class="text-center">Login</h3>
    <div class="mb-3">
      <label for="loginUsername" class="form-label">Username</label>
      <input type="text" class="form-control" id="loginUsername" required>
    </div>
    <div class="mb-3">
      <label for="loginPassword" class="form-label">Password</label>
      <input type="password" class="form-control" id="loginPassword" required>
    </div>
    <button class="btn btn-success w-100" onclick="loginUser()">Sign In</button>
    <p class="text-center mt-3">Don't have an account? <a href="#" onclick="showSignup()">Sign up</a></p>
  </div>

  <!-- Dashboard Section -->
  <div class="dashboard" id="dashboardSection">
    <h3 class="text-center mb-4">Welcome, <span id="userDisplay"></span></h3>

    <div class="row">
      <!-- Water Level Summary Card -->
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-header">Water Level</div>
          <div class="card-body">
            <h4 id="waterLevel">0%</h4>
            <p>Status: <strong id="tankStatus">-</strong></p>
            <p>Last Update: <span id="lastUpdated">--:--</span></p>
          </div>
        </div>
      </div>

      <!-- Live Water Level Chart -->
      <div class="col-md-8">
        <div class="card">
          <div class="card-header">Live Water Level</div>
          <div class="card-body chart-container">
            <canvas id="levelChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Weekly Water Usage Chart -->
    <div class="card mt-4">
      <div class="card-header">Weekly Water Usage</div>
      <div class="card-body chart-container">
        <canvas id="usageChart"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript Section -->
<script>
  let users = []; // Simulated user database (for demo only)

  // Toggle between light and dark themes
  function toggleTheme() {
    const currentTheme = document.body.getAttribute("data-theme");
    document.body.setAttribute("data-theme", currentTheme === "light" ? "dark" : "light");
  }

  // Show Login form
  function showLogin() {
    document.getElementById("signupSection").style.display = 'none';
    document.getElementById("loginSection").style.display = 'block';
  }

  // Show Sign Up form
  function showSignup() {
    document.getElementById("loginSection").style.display = 'none';
    document.getElementById("signupSection").style.display = 'block';
  }

  // Sign up a new user
  function signUpUser() {
    const username = document.getElementById("signupUsername").value.trim();
    const password = document.getElementById("signupPassword").value.trim();
    
    if (!username || !password) return alert("Please fill in all fields.");
    if (users.some(u => u.username === username)) return alert("Username already exists.");
    
    users.push({ username, password });
    alert("Account created successfully! Please log in.");
    showLogin();
  }

  // Authenticate and log in a user
  function loginUser() {
    const username = document.getElementById("loginUsername").value.trim();
    const password = document.getElementById("loginPassword").value.trim();
    
    const user = users.find(u => u.username === username && u.password === password);
    if (!user) return alert("Invalid login credentials.");
    
    document.getElementById("loginSection").style.display = 'none';
    document.getElementById("dashboardSection").style.display = 'block';
    document.getElementById("userDisplay").textContent = username;

    initializeDashboard(); // Load charts and start updates
  }

  // Initialize dashboard charts and simulate updates
  function initializeDashboard() {
    let chartLabels = [];
    let chartData = [];

    const ctx1 = document.getElementById("levelChart").getContext("2d");
    const ctx2 = document.getElementById("usageChart").getContext("2d");

    // Line chart for real-time water level
    const levelChart = new Chart(ctx1, {
      type: 'line',
      data: {
        labels: chartLabels,
        datasets: [{
          label: 'Water Level (%)',
          data: chartData,
          borderColor: '#0d6efd',
          backgroundColor: 'rgba(13,110,253,0.2)',
          fill: true,
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            min: 0,
            max: 100,
            title: { display: true, text: "Level (%)" }
          },
          x: { title: { display: true, text: "Time" } }
        }
      }
    });

    // Static bar chart for weekly usage
    const usageChart = new Chart(ctx2, {
      type: 'bar',
      data: {
        labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
        datasets: [{
          label: 'Liters Used',
          data: [150, 180, 100, 130, 90],
          backgroundColor: '#0d6efd'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: { display: true, text: 'Weekly Water Usage' }
        }
      }
    });

    // Simulate water level updates every 5 seconds
    function update() {
      let waterLevel = Math.floor(Math.random() * 100); // Simulated level
      const time = new Date().toLocaleTimeString();

      document.getElementById("waterLevel").textContent = `${waterLevel}%`;
      document.getElementById("lastUpdated").textContent = time;
      document.getElementById("tankStatus").textContent = 
        waterLevel > 75 ? 'Full' : 
        waterLevel > 40 ? 'Medium' : 
        waterLevel > 10 ? 'Low' : 'Empty';

      // Update chart data
      if (chartLabels.length >= 10) {
        chartLabels.shift();
        chartData.shift();
      }
      chartLabels.push(time);
      chartData.push(waterLevel);
      levelChart.update();
    }

    update();
    setInterval(update, 5000);
  }

  // Show signup by default on page load
  showSignup();
</script>

</body>
</html>
